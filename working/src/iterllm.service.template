[Unit]
Description=IterLLM Runtime Service
After=network-online.target

[Service]
# EnvironmentFile removed - values are baked in at install time

# --- Security & Isolation ---
Type=exec
PrivateMounts=yes
PrivateTmp=yes
ProtectSystem=full
NoNewPrivileges=yes
LockPersonality=yes
MemoryDenyWriteExecute=yes
RestrictSUIDSGID=yes
ProtectKernelTunables=yes
ProtectKernelModules=yes
ProtectKernelLogs=yes

# --- Credentials ---
# Decrypts %h/.config/credstore.encrypted/my_api_key -> $CREDENTIALS_DIRECTORY/my_api_key
LoadCredentialEncrypted=my_api_key:%h/.config/credstore.encrypted/my_api_key

# Make the credential path explicit for the binary.
Environment=ITERLLM_API_KEY_FILE=%d/my_api_key

# --- Binary Execution ---
ExecStart={{BINARY_PATH}}

[Install]
WantedBy=default.target
